# K8S-1.11_install

## 参考链接

[官网地址：](https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/)

## 一、环境准备

```bash
# 实验架构
lab1: master 11.11.11.111
lab2: node 11.11.11.112
lab3: node 11.11.11.113
 
# cat /etc/redhat-release
CentOS Linux release 7.4.1708 (Core)
```

## 二、**实验使用的文件：**`Vagrantfile和init.sh`

```bash
# 所需box文件CentOS-7-x86_64-Vagrant-1801_02.VirtualBox.box
wget -c http://cloud.centos.org/centos/7/vagrant/x86_64/images/CentOS-7-x86_64-Vagrant-1801_02.VirtualBox.box
vagrant box add CentOS-7-x86_64-Vagrant-1801_02.VirtualBox.box --name centos/7

# 添加box
```

```bash
# cat <<EOF >  Vagrantfile
 
# -*- mode: ruby -*-
# vi: set ft=ruby :
 
ENV["LC_ALL"] = "en_US.UTF-8"
 
Vagrant.configure("2") do |config|
    (1..3).each do |i|
      # config.vm.provision "shell", path: "init.sh"
      config.vm.define "lab#{i}" do |node|
        node.vm.box = "centos/7"
        node.ssh.insert_key = false
        node.vm.hostname = "lab#{i}"
        node.vm.network "private_network", ip: "11.11.11.11#{i}"
        # node.vm.synced_folder "~/Desktop/share", "/home/vagrant/share"
        node.vm.provision "shell", path: "init.sh"
        node.vm.provider "virtualbox" do |v|
          v.cpus = 2
          v.customize ["modifyvm", :id, "--name", "lab#{i}", "--memory", "2048"]
        end
      end
    end
end
 
EOF
```

```bash
# cat <<EOF > init.sh
 
#!/bin/bash
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
export PATH
 
cat >>/etc/hosts<<EOF
11.11.11.111 lab1
11.11.11.112 lab2
11.11.11.113 lab3
EOF
 
echo "nameserver 219.141.136.10">/etc/resolv.conf
cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
timedatectl set-timezone Asia/Shanghai
 
yum install -y wget
cd /etc/yum.repos.d && mv CentOS-Base.repo CentOS-Base.repo.bak
wget -O CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo
yum clean all && yum makecache
yum install -y  lrzsz git
systemctl stop firewalld.service && systemctl disable firewalld.service
 
setenforce 0
sed -i 's/=enforcing/=disabled/g' /etc/selinux/config
 
cat >> /etc/sysctl.conf <<EOF
net.ipv4.ip_forward=1
EOF
sysctl -p
 
echo 'disable swap'
        swapoff -a
        sed -i '/swap/s/^/#/' /etc/fstab
         
egrep "^docker" /etc/group >& /dev/null
        if [ $? -ne 0 ]
        then
          groupadd docker
        fi
 
        usermod -aG docker vagrant
        rm -rf ~/.docker/
        yum install -y docker.x86_64
systemctl start docker && systemctl enable docker
 
cat > /etc/docker/daemon.json <<EOF
{
  "registry-mirrors" : ["https://de5884ui.mirror.aliyuncs.com"]
}
EOF
 
EOF
```

```bash
# 以上是通过Vagrant和VirtualBox自动创建虚拟机3台，并进行相应的初始化。
# 若虚拟机已创建完毕，请做以下初始化。
```

1. 关闭防火墙和
2. selinux
3. 修改主机名及hosts
4. 设置DNS
5. 更改Yum源
6. 关闭swap
7. 安装docker
8. 配置docker加速器

## 三、如下操作在所有节点操作：

1. ## 安装 kubeadm, kubelet 和 kubectl

   ```bash
   
   ```

2. ## 配置启动kubelet 

```bash


```

* 安装istio难点还是GCR上下载镜像，镜像我已经上传到dockerhub；

```

```



## 四、如下操作在master节点操作：

```bash

```

* 客户端浏览器增加hosts映射域名和主机，访问`istio-grafana.k8s.local`访问grafana；

## 五、如下操作在node节点操作：

```bash

```

## 六、测试

```bash

```

* 
